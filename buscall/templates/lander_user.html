{% extends "base.html" %}
{% block title %}Home{% endblock %}
{% block header %}
  <h1>Bus Calling</h1>
  <h2>Time management before the coffee kicks in.</h2>
{% endblock %}
{% from "_formhelpers.html" import with_errors %}
{% block main %}
<p>Welcome {{profile.name}}, you're logged in!</p>
<form method="POST" action="{{ url_for('lander') }}">
    <input type="hidden" name="_method" value="PUT" />
    {{form.hidden_tag()}}
    {{with_errors(form.first_name)}}
    {{with_errors(form.last_name)}}
    {{with_errors(form.phone)}}
    <input type="submit" value="Update" />
</form>
{% if profile.listeners.fetch(1) %}
<ul>
{% for listener in profile.listeners %}
  <li>{{listener}}
    <form action="{{url_for('destroy_listener', listener_id=listener.id)}}" method="POST">
        <input type="hidden" name="_method" value="DELETE" />
        <input type="submit" value="Delete Listener" />
    </form>
  </li>
{% endfor %}
</ul>
{% else %}
<p>You have no listeners.</p>
{% endif %}
<a href="{{url_for('new_listener')}}">New Listener</a>

{% if profile.paid %}
<p>Your account is paid up, and your listeners are all active.</p>
<a href="https://www.paypal.com/cgi-bin/webscr?cmd=_subscr-find&amp;alias=WYWXRN23UG45Q">
<img src="https://www.paypalobjects.com/en_US/i/btn/btn_unsubscribe_LG.gif">
</a>

{% else %}
<p>Your account is unpaid, and your listeners are inactive. Activate them by purchasing a subscription!</p>
<form action="https://www.paypal.com/cgi-bin/webscr" method="post">
<div style="display:none;">
  <input type="hidden" name="cmd" value="_s-xclick" />
  <input type="hidden" name="hosted_button_id" value="W42Q7VA9H8USQ" />
  <input type="hidden" name="custom" value="{{profile.user_id}}" />
  <input type="hidden" name="notify_url" value="https://buscalling.appspot.com{{ url_for('paypal_ipn') }}" />
</div>
<input type="image" src="https://www.paypalobjects.com/en_US/i/btn/btn_subscribeCC_LG.gif" name="submit" alt="Subscribe with PayPal">
<img alt="" src="https://www.paypalobjects.com/en_US/i/scr/pixel.gif" />
</form>
{% endif %}
{% endblock %}